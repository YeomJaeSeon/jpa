# 단방향 연관관계와 양방향 연관관계

- 한팀에는 여러명의 회원이 있을수 있다.
- 회원 table : 팀 table = N : 1(다대일 관계)
- 관계라는것은 두 테이블간의 레코드가 몇대 몇관계인지를 나타내는 것이다.

1. 단방향 연관관계

- 객체에서 단방향 연관관계를 설정할수있다.
- Member 엔티티 내에서 Team이라는 참조변수를 통해서 Member -> Team에 참조할수있다. 이는 반대는 안되고 Member-> Team만되기에 단방향 연관관계이다.(양방향 연관관계를 설정하려면 Team에서도 Member의 참조가 있어야한다.)

2. 양방향 연관관계

- 두 테이블의 연관관계를 나타내는 것은 외래키를 통해서 join하면된다. 그럼 가상의 테이블 (외래키를 기준으로 기반테이블 두개를 합친 뷰!)을 통해서 서로간의 관계가 설정된다.
- 객체와는 다르게.. 테이블은 **외래키만 있으면 양방향 연관관계가 가능하다**

# 객체의 연관관계 vs 테이블 연관관계

1. 객체의 연관관계

- 객체간의 관계를 나타내려면(객체 그래프탐색처럼.) 당연히 해당 객체의 멤버변수로 관계를 설정하고싶은 다른 객체의 참조변수를 가지고있으면된다.(포함관계라고 한다.)

- 기본적으로 단방향 연관관계이다.(한쪽객체에서 다른객체로 관계를 설정하면. 반대편 객체에서 참조변수를 또 갖으면 양방향 연관관계가 되지만 실질적으론 단방향연관관계가 두개인 셈이다.)

- A -> B

```java
class A{
  B b;
}
```

- B -> A

```java
class B{
  A a;
}
```

- 즉 기본적으로 단방향 연관관계를 가지고있다.
- 객체의 양방향 연관관계라는것은 단방향 연관관계 두개를 의미한다.(-> , <-)

2. 테이블 연관관계

- 테이블의 연관관계는 하나의 외래키를 통해서 두 기반테이블을 합쳐서 뷰를 만들어서 해당 뷰를 통해서 양방향 연관관계가 기본적으로 가능하다.
- 기본적으로 양방향 연관관계이다.

# 연관관계 주인

- 위에서 계속 말한것의 중요한 요점은 객체의 연관관계와 테이블의 연관관계의 차이이다.
- 객체는 단방향 연관관계를 서로 가지면 양방향이되지만 테이블은 기본적으로 외래키 하나로 양방향 연관관계가 된다.

- 즉 **객체에서의 서로간의 연관관계를 갖기위한 두개의 참조변수와 테이블의 하나의 외래키를 어떻게 매핑할까?** 라는 의문이 생길것이다.

- Member객체의 Team으로의 참조변수와 외래키를 매핑해야할지, Team객체의 Member로의 참조변수와 외래키를 매핑해야할지 딜레마가생김..

- Member가 팀을 변경하였을때, Member객체의 Team으로의 참조변수를 업데이트해야할지..(Member 참조와 외래키 매핑할지..), Team객체의 Member로의 참조변수를 업데이트 해야할지..(Team 참조와 외래키 매핑할지..)

- 그래서 두개의 참조변수(서로간의 객체를 참조하는 객체의 참조변수)중 하나로 외래키를 관리해야한다는 RULE이 생김.!!

- 그 하나가 바로 연관관계 주인이다.

- 즉, 두 객체의 관계를 나타내는 **두 참조변수중 하나를 연관관계의 주인** 으로 지정해야한다.

- 연관관계의 주인인 참조변수만이 외래키와 매핑되어, 외래키를 관리해야한다.(등록이나 수정..)

- 연관관계의 주인 반대편인, 주인이 아닌 참조변수는 단순히 읽기만 가능해야한다.

- 주인은 mappedBy속성 사용하지않고 주인 반대편은 mappedBy속성으로 주인을 지정한다.

# 연관관계 주인은 누구로?

- 객체의 양방향 관계를 나타내는 두 참조변수중 누굴 연관관계 주인으로 해야할까?
- **외래키가 있는 곳을 주인으로 정한다**
- 외래키가 있는 테이블은 (다, N)이므로 N인곳을 연관관계 주인으로 정한다(@ManyTo ~)인 엔티티..

- N(다)를 나타내는 곳의 엔티티를 연관관계 주인 즉,진짜 외래키와 매핑하고, 1(일)을 나타내는 곳의엔티티는 mappedBy로 주인을 지정하여 주인 반대편,으로 외래키와 가짜매핑한다.
- 연관관계 주인은 외래키를 관리하며, 연관관계 주인반대편(mappedBy한 엔티티)은 단순히 읽기밖에하지못한다.

# 결론

1. 양 방향 연관관계의 객체에서 연관관계를 나타내는 두 참조변수중 하나만 외래키와 매핑해야한다.
2. 외래키와 진짜 매핑된 참조변수가있는 엔티티를 연관관계 주인이라하고 가짜 매핑된 참조변수가있는 엔티티를 연관관계 주인이 아니라고한다.
3. 연관관계 주인인 참조변수는 외래키를 관리(등록이나 수정)할수있고, 주인이 아닌 참조변수는 단순히 조회만가능하다.
4. 연관관계 주인이 아닌 참조변수는 mappedBy속성을 이용해서 주인을 지정해야한다.
5. 연관관계 주인은 외래키가 있는 엔티티의 참조변수로 하고, 외래키가 있는 테이블은 N(다)쪽이므로 N쪽을 연관관계 주인으로 한다.
