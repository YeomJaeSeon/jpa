# jpa에서 다양한 쿼리방법이 필요

- 지금까지 배운 방법으로 jpa를 통해서 DB에 데이터를 조회할때 사용한 방법으로는

1. `em.find(Member.class, member.getId());`
2. `member.getTeam().getTeamName()` - 프록시객체일때.. (in 지연로딩)

- 이런식으로 조회했따
- 그런데 나이가 20살 이상인 모든 회원을 조회해야한다고 할때는 어떻게할까?
- 조건에 맞는 엔티티 객체를 여러개 뽑아야할텐데 엔티티객체 하나만 뽑는게 아니닌까 어케하지?

-> 바로 조건을 포함한 검색쿼리를 이용해야한다. (SELECT \* FROM MEMBER WHERE MEMBER.AGE >= 20) 이런식으로.!

- 즉 **jpa에서 쿼리를 사용해야한다**

# jpa에서 쿼리를 사용하는 다양한방법들

1. jpql

- Java Persistence Query Language로 jpa에서 엔티티 객체를 대상으로 쿼리를 날릴수있는 방법이다.(테이블 대상으로 쿼리를 날리는 SQL과 다르다)

2. JPA Criteria

- 좀이따 보면알겠지만 jpql은 문자열로되어있어서 오류도많이나고, 동적쿼리(동적으로 만드는 쿼리)도 만들기가 너무어렵다. 문자열 연산해야하는데 자바는 String 인스턴스는 불변객체고.. 연산할때마다 새로운 인스턴스생성해야되서 메모리 계속할당되고... 이러한 문제점을 해결하기위해 자바 표준 기술인 jpql을 자바 언어로 만드는 방법이다.
- 단점은 너무 복잡하다.

3. QueryDSL

- 오픈소스 라이브러리이다.
- criteria와 같이 jpql을 동적으로 만들수있게 자바언어를 통해서 jpql을 만드는 방법을지원한다.
- 컴파일로 오류를 가져와 안전하며, 동적쿼리만들기도쉬움
- 무엇보다도 Criteria 보다 훨씬 쉽고 간닪다ㅏ

4. 네이티브 SQL

- 진짜 DB테이블 대상으로하는 생짜 SQL이다.

5. JDBC API직접사용 - MyBatis, SpringJDBCTemplate

- DB 커넥션 직접사용하는 방법이다.

# JPQL

- JPA는 왜사용한다했지? 바로 객체지향언어와 관계형데이터베이스간의 패러다임의 불일치로, 둘을 같이 쓸때, 둘간의 매핑을 개발자가 직접하기에 너무 복잡하기에 사용한다. ORM기술이라했다.(자바에서 사용하는)
- jpa는 그렇기에 테이블과 매핑되는 엔티티 객체를 중심으로 개발을 한다.
- 근데 20세이상의 회원을 조회해야하는 상황에선 검색쿼리를 직접짜야한다. 어쩔수없다.
- 이때, jpql을 사용하면 테이블이 아닌 엔티티 객체를 대상으로 쿼리를 짤수있다.
- 즉 jpa에서 객체를 대상으로 쿼리를 짤수있는 방법이 바로 jpql이다.
- DB에서 모든데이터 쿼리해서, 객체로 받아서 조건을 조회할순있지만 그만큼 네트워크도 많이타고, DB성능도 안나올테니 이부분은 제외한다.

정리하면

1. JPA는 SQL을 추상화한 JPQL이라는 **객체 지향 쿼리 언어**를 제공한다.
2. SQL과 유사하다.(SQL표준은 모두지원)
3. SQL은 DB 테이블을 대상으로 쿼리하는 반면, JPQL은 엔티티 객체를 대상으로 쿼리한다.
4. 결국 마지막엔 JPQL도 SQL로 변경된다.
